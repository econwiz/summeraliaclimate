----------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /user/ab5405/summeraliaclimate/output/age_combined_regressions_car.log
  log type:  text
 opened on:  22 Jul 2025, 09:48:39

. *****************************************************************************
. *                                               PART 2. OLS Regressions                                     *
. *****************************************************************************
. 
. * 1. set weighting schemes
. bysort year: egen tot_pop = total(population)

. gen weight = population / tot_pop

. 
. 
. * 2. run regressions
. 
. * specification 1
. reghdfe deathrate_w99 tavg_poly_1_GMFD tavg_poly_2_GMFD tavg_poly_3_GMFD tavg_poly_4_GMFD ///
>                 [pw = weight]  ///
>                 , absorb(i.adm2_code#i.CHN_ts#i.agegroup i.adm0_code#i.year ) ///
>                 cluster(adm1_code)
(dropped 1833 singleton observations)
(MWFE estimator converged in 25 iterations)

HDFE Linear regression                            Number of obs   =    100,520
Absorbing 2 HDFE groups                           F(   4,    224) =       0.49
Statistics robust to heteroskedasticity           Prob > F        =     0.7434
                                                  R-squared       =     0.9900
                                                  Adj R-squared   =     0.9868
                                                  Within R-sq.    =     0.0005
Number of clusters (adm1_code) =        225       Root MSE        =   162.9795

                                (Std. err. adjusted for 225 clusters in adm1_code)
----------------------------------------------------------------------------------
                 |               Robust
   deathrate_w99 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-----------------+----------------------------------------------------------------
tavg_poly_1_GMFD |  -.0121922   .0677101    -0.18   0.857    -.1456225     .121238
tavg_poly_2_GMFD |   -.002141   .0029613    -0.72   0.470    -.0079765    .0036946
tavg_poly_3_GMFD |   .0003267   .0002863     1.14   0.255    -.0002376    .0008909
tavg_poly_4_GMFD |  -7.14e-06   6.15e-06    -1.16   0.247    -.0000193    4.98e-06
           _cons |   649.4009   238.6986     2.72   0.007     179.0188    1119.783
----------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------------+
                   Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------------------+---------------------------------------|
     adm2_code#CHN_ts#agegroup |     23466       23466           0    *|
                adm0_code#year |       466           1         465     |
-----------------------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates save "`sterdir'/pooled_response_spec1_public_car.ster", replace
file /user/ab5405/summeraliaclimate/output/age_combined_car/pooled_response_spec1_public_car.ster saved

. 
. * specification 2
. reghdfe deathrate_w99 tavg_poly_1_GMFD tavg_poly_2_GMFD tavg_poly_3_GMFD tavg_poly_4_GMFD ///
>                 [pw = weight] ///
>                 , absorb(i.adm2_code#i.CHN_ts#i.agegroup  i.adm0_code#i.year#i.agegroup ) ///
>                 cluster(adm1_code) residual(e_hat)
(dropped 2111 singleton observations)
(MWFE estimator converged in 20 iterations)

HDFE Linear regression                            Number of obs   =    100,242
Absorbing 2 HDFE groups                           F(   4,    223) =       1.44
Statistics robust to heteroskedasticity           Prob > F        =     0.2222
                                                  R-squared       =     0.9978
                                                  Adj R-squared   =     0.9970
                                                  Within R-sq.    =     0.0002
Number of clusters (adm1_code) =        224       Root MSE        =    76.7568

                                (Std. err. adjusted for 224 clusters in adm1_code)
----------------------------------------------------------------------------------
                 |               Robust
   deathrate_w99 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-----------------+----------------------------------------------------------------
tavg_poly_1_GMFD |  -.0087934   .0236257    -0.37   0.710    -.0553515    .0377647
tavg_poly_2_GMFD |  -.0004168    .000838    -0.50   0.619    -.0020682    .0012346
tavg_poly_3_GMFD |   .0000257   .0000683     0.38   0.707    -.0001089    .0001602
tavg_poly_4_GMFD |   1.23e-08   1.44e-06     0.01   0.993    -2.82e-06    2.84e-06
           _cons |    754.772   63.31195    11.92   0.000     630.0057    879.5383
----------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------------+
                   Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------------------+---------------------------------------|
     adm2_code#CHN_ts#agegroup |     23445       23445           0    *|
       adm0_code#year#agegroup |      1014           1        1013     |
-----------------------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates save "`sterdir'/pooled_response_spec2_public_car.ster", replace
file /user/ab5405/summeraliaclimate/output/age_combined_car/pooled_response_spec2_public_car.ster saved

. * save rediduals for FGLS regressions
. 
. * specification 3
. reghdfe deathrate_w99 tavg_poly_1_GMFD tavg_poly_2_GMFD tavg_poly_3_GMFD tavg_poly_4_GMFD ///
>                 [pw = weight] ///
>                 , absorb(i.adm2_code#i.CHN_ts#i.agegroup i.adm0_code#i.year#i.agegroup adm1_agegrp_code##c.yea
> r) ///
>                 cluster(adm1_code)
(dropped 2111 singleton observations)
(MWFE estimator converged in 30 iterations)

HDFE Linear regression                            Number of obs   =    100,242
Absorbing 3 HDFE groups                           F(   4,    223) =       2.45
Statistics robust to heteroskedasticity           Prob > F        =     0.0469
                                                  R-squared       =     0.9981
                                                  Adj R-squared   =     0.9974
                                                  Within R-sq.    =     0.0002
Number of clusters (adm1_code) =        224       Root MSE        =    71.9643

                                (Std. err. adjusted for 224 clusters in adm1_code)
----------------------------------------------------------------------------------
                 |               Robust
   deathrate_w99 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-----------------+----------------------------------------------------------------
tavg_poly_1_GMFD |   .0180943   .0188095     0.96   0.337    -.0189729    .0551615
tavg_poly_2_GMFD |  -.0012027   .0005914    -2.03   0.043    -.0023682   -.0000373
tavg_poly_3_GMFD |  -.0000119   .0000552    -0.22   0.829    -.0001208     .000097
tavg_poly_4_GMFD |   9.70e-07   1.15e-06     0.84   0.401    -1.30e-06    3.24e-06
           _cons |   728.8428   53.46022    13.63   0.000     623.4909    834.1946
----------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------------+
                   Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------------------+---------------------------------------|
     adm2_code#CHN_ts#agegroup |     23445       23445           0    *|
       adm0_code#year#agegroup |      1014           1        1013     |
              adm1_agegrp_code |       654         654           0    *|
       adm1_agegrp_code#c.year |       654           0         654    ?|
-----------------------------------------------------------------------+
? = number of redundant parameters may be higher
* = FE nested within cluster; treated as redundant for DoF computation

. estimates save "`sterdir'/pooled_response_spec3_public_car.ster", replace
file /user/ab5405/summeraliaclimate/output/age_combined_car/pooled_response_spec3_public_car.ster saved

. 
. 
. *****************************************************************************
. *                                               PART 3. FGLS Regressions                                    *
. *****************************************************************************
. 
. * 1. generate weighting matrix
. * get residuals from 1st stage and
. * calculate diagonal elements of the weighting matrix
. gen e2 = e_hat * e_hat
(2,111 missing values generated)

. 
. bysort adm1_code: egen omega = sd(e_hat) if e_hat != .
(2,111 missing values generated)

. gen precisionweight = weight * 1/(omega*omega) 
(2,111 missing values generated)

. 
. sort iso adm1_id adm2_id year agegroup

. 
. * 2. run regressions
. * specification 4
. reghdfe deathrate_w99 tavg_poly_1_GMFD tavg_poly_2_GMFD tavg_poly_3_GMFD tavg_poly_4_GMFD ///
>                 [pw = precisionweight] ///
>                 , absorb(i.adm2_code#i.CHN_ts#i.agegroup i.adm0_code#i.year#i.agegroup) ///
>                 cluster(adm1_code) tol(1e-7)
(MWFE estimator converged in 23 iterations)

HDFE Linear regression                            Number of obs   =    100,242
Absorbing 2 HDFE groups                           F(   4,    223) =       0.17
Statistics robust to heteroskedasticity           Prob > F        =     0.9519
                                                  R-squared       =     0.9998
                                                  Adj R-squared   =     0.9997
                                                  Within R-sq.    =     0.0002
Number of clusters (adm1_code) =        224       Root MSE        =    21.0282

                                (Std. err. adjusted for 224 clusters in adm1_code)
----------------------------------------------------------------------------------
                 |               Robust
   deathrate_w99 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-----------------+----------------------------------------------------------------
tavg_poly_1_GMFD |  -.0015469   .0175447    -0.09   0.930    -.0361215    .0330276
tavg_poly_2_GMFD |  -.0005028   .0007379    -0.68   0.496    -.0019569    .0009513
tavg_poly_3_GMFD |   .0000465   .0000673     0.69   0.490    -.0000861     .000179
tavg_poly_4_GMFD |  -9.10e-07   1.70e-06    -0.54   0.592    -4.25e-06    2.43e-06
           _cons |   615.9548   45.54745    13.52   0.000     526.1963    705.7133
----------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------------+
                   Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------------------+---------------------------------------|
     adm2_code#CHN_ts#agegroup |     23445       23445           0    *|
       adm0_code#year#agegroup |      1014           1        1013     |
-----------------------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates save "`sterdir'/pooled_response_spec4_public_car.ster", replace
file /user/ab5405/summeraliaclimate/output/age_combined_car/pooled_response_spec4_public_car.ster saved

. 
. 
. *****************************************************************************
. *                                               PART 4. 13-month ave T Regressions                          *
. *****************************************************************************
. 
. * specification 5
. reghdfe deathrate_w99 tavg_poly_1_GMFD_13m tavg_poly_2_GMFD_13m tavg_poly_3_GMFD_13m tavg_poly_4_GMFD_13m ///
>                 [pw = weight] ///
>                 , absorb(i.adm2_code#i.CHN_ts#i.agegroup i.adm0_code#i.year#agegroup ) ///
>                 cluster(adm1_code)
(dropped 1998 singleton observations)
(MWFE estimator converged in 20 iterations)

HDFE Linear regression                            Number of obs   =     63,680
Absorbing 2 HDFE groups                           F(   4,    191) =       1.42
Statistics robust to heteroskedasticity           Prob > F        =     0.2288
                                                  R-squared       =     0.9985
                                                  Adj R-squared   =     0.9979
                                                  Within R-sq.    =     0.0004
Number of clusters (adm1_code) =        192       Root MSE        =    65.7680

                                    (Std. err. adjusted for 192 clusters in adm1_code)
--------------------------------------------------------------------------------------
                     |               Robust
       deathrate_w99 | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
---------------------+----------------------------------------------------------------
tavg_poly_1_GMFD_13m |  -.0150849   .0236889    -0.64   0.525    -.0618104    .0316406
tavg_poly_2_GMFD_13m |   -.000473   .0009015    -0.52   0.600    -.0022511    .0013051
tavg_poly_3_GMFD_13m |   .0000865   .0000683     1.27   0.207    -.0000481    .0002211
tavg_poly_4_GMFD_13m |  -1.55e-06   1.46e-06    -1.06   0.292    -4.43e-06    1.34e-06
               _cons |   764.8539   62.24208    12.29   0.000     642.0837     887.624
--------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------------+
                   Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------------------------+---------------------------------------|
     adm2_code#CHN_ts#agegroup |     16579       16579           0    *|
       adm0_code#year#agegroup |       951           1         950     |
-----------------------------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation

. estimates save "`sterdir'/pooled_response_spec5_public_car.ster", replace
file /user/ab5405/summeraliaclimate/output/age_combined_car/pooled_response_spec5_public_car.ster saved

. 
end of do-file

. use "/shared/share_hle/data/aux_data/global_mortality_panel_public.dta", clear

. 
. * Their precip variables are named prcp_poly_1_GMFD … prcp_poly_4_GMFD

. describe prcp_poly* 

Variable      Storage   Display    Value
    name         type    format    label      Variable label
----------------------------------------------------------------------------------------------------------------
prcp_poly_1_G~D float   %9.0g                 
prcp_poly_1_G~m float   %9.0g                 
prcp_poly_1_U~L float   %9.0g                 
prcp_poly_1_U~m float   %9.0g                 
prcp_poly_2_G~D float   %9.0g                 
prcp_poly_2_G~m float   %9.0g                 
prcp_poly_2_U~L float   %9.0g                 
prcp_poly_2_U~m float   %9.0g                 
prcp_poly_3_G~D float   %9.0g                 
prcp_poly_3_G~m float   %9.0g                 
prcp_poly_3_U~L float   %9.0g                 
prcp_poly_3_U~m float   %9.0g                 
prcp_poly_4_G~D float   %9.0g                 
prcp_poly_4_G~m float   %9.0g                 
prcp_poly_4_U~L float   %9.0g                 
prcp_poly_4_U~m float   %9.0g                 
prcp_poly_5_G~D float   %9.0g                 
prcp_poly_5_G~m float   %9.0g                 
prcp_poly_5_U~L float   %9.0g                 
prcp_poly_5_U~m float   %9.0g                 
prcp_poly_1_G~3 float   %9.0g                 
prcp_poly_1_U~3 float   %9.0g                 
prcp_poly_2_G~3 float   %9.0g                 
prcp_poly_2_U~3 float   %9.0g                 
prcp_poly_3_G~3 float   %9.0g                 
prcp_poly_3_U~3 float   %9.0g                 
prcp_poly_4_G~3 float   %9.0g                 
prcp_poly_4_U~3 float   %9.0g                 
prcp_poly_5_G~3 float   %9.0g                 
prcp_poly_5_U~3 float   %9.0g                 

. egen sd_prcp = sd(prcp_poly_1_GMFD), by(adm1_code)
variable adm1_code not found
(error in option by())
r(111);

. egen sd_prcp = sd(prcp_poly_1_GMFD), by(adm1_id)

. summ sd_prcp

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     sd_prcp |    639,476    460.5868    148.8609    65.3945   1066.416

. sort adm1_code year
variable adm1_code not found
r(111);

. list adm1_code year prcp_poly_1_GMFD if adm1_code=="AUT.AT1" in 1/10
variable adm1_code not found
r(111);

. sort adm1_id year

. list adm1_id year prcp_poly_1_GMFD if adm1_code=="AUT.AT1" in 1/10
adm1_code not found
r(111);

. sort adm1_id year

. list adm1_id year prcp_poly_1_GMFD if adm1_id=="AUT.AT1" in 1/10

